代码来自@Orz-3 仅做部分修改
